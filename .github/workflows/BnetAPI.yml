
name: BNet API Training
on:  
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:
env:
  ACCOUNT_REGION: eu
  GAMER_TAG: Brodde#2647
jobs:
  job1:
    runs-on: ubuntu-latest
    outputs:
     # access-token: ${{steps.bnet-auth.outputs.access-token}}
      matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
    
      - name: Check out repo
        uses: actions/checkout@v2

      - name: Authenticate with BNet
        id: bnet-auth
        shell: pwsh  
        run: |
          $AccessToken =  ./Scripts/GetBnetToken.ps1 ${{secrets.WOW_CLIENT_ID}} ${{secrets.WOW_CLIENT_SECRET}} ${{env.ACCOUNT_REGION}}
      #    echo "::set-output name=access-token::$AccessToken"
          
      - name: Get Characters from Server
        id: set-matrix
        shell: pwsh  
        run: echo "::set-output name=matrix::{\"include\":[{\"project\":\"foo\",\"config\":\"Debug\"},{\"project\":\"bar\",\"config\":\"Release\"}]}"
  job2:
    needs: job1
    runs-on: ubuntu-latest
    strategy:
      matrix: ${{fromJson(needs.job1.outputs.matrix)}}
    steps:
    - run: echo ${{ matrix.project }}
    - run: echo ${{ matrix.config }}
          

          
          #$Characters = ./Scripts/GetCharactersFromServer.ps1 ${{steps.bnet-auth.outputs.access-token }} ${{env.ACCOUNT_REGION}} ${{env.GAMER_TAG}}
          #Write-Host $Characters